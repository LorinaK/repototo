Here I have included some changes and tests and I have fixed the bug
